<div class="product-form-container">
    <!-- Header -->
    <div class="form-header">
        <h1 class="form-title">Thêm sản phẩm</h1>
        <button mat-flat-button color="primary" class="save-btn" (click)="onSave()" [disabled]="isLoading">
            <mat-icon>save</mat-icon>
            <span>Lưu</span>
        </button>
    </div>

    <!-- Form Content -->
    <div class="form-content">
        <form [formGroup]="productForm" class="product-form">

            <!-- ===== KHỐI 1: THÔNG TIN CƠ BẢN ===== -->
            <div class="form-section top-section">
                <!-- Image Upload -->
                <div class="image-upload-wrapper">
                    <div class="image-upload-area" (click)="triggerFileUpload()">
                        <div *ngIf="!selectedImagePreview" class="image-placeholder">
                            <mat-icon>image</mat-icon>
                        </div>
                        <img *ngIf="selectedImagePreview" [src]="selectedImagePreview" alt="Product image"
                            class="preview-image">
                        <input #fileInput type="file" accept="image/*" (change)="onImageSelect($event)"
                            style="display: none">
                    </div>
                </div>

                <!-- Basic Info Fields -->
                <div class="basic-info-fields">
                    <!-- Tên sản phẩm -->
                    <div class="form-field full-width">
                        <label class="field-label required">Tên sản phẩm</label>
                        <mat-form-field appearance="outline" class="form-input">
                            <input matInput placeholder="Nhập tên sản phẩm" formControlName="name">
                        </mat-form-field>
                    </div>
                    <!-- Danh mục, Thương hiệu, Vị trí -->
                    <div class="form-row three-columns">
                        <div class="form-field">
                            <label class="field-label required">Danh mục</label>
                            <mat-form-field appearance="outline" class="form-select">
                                <mat-select placeholder="Vui lòng chọn danh mục" formControlName="category">
                                    <mat-option *ngFor="let category of categories" [value]="category.value">
                                        {{category.label}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Thương hiệu</label>
                            <mat-form-field appearance="outline" class="form-input">
                                <input matInput placeholder="Nhập thương hiệu" formControlName="brand">
                            </mat-form-field>
                        </div>
                        <div class="form-field">
                            <label class="field-label">Vị trí để hàng</label>
                            <mat-form-field appearance="outline" class="form-input">
                                <input matInput placeholder="VD: Khu A, kệ số 4 tầng 2" formControlName="location">
                            </mat-form-field>
                        </div>
                    </div>
                    <!-- Variants Checkbox -->
                    <div class="form-row">
                        <div class="checkbox-field">
                            <mat-checkbox formControlName="hasVariants" color="primary">
                                Phân theo thuộc tính hàng hóa
                            </mat-checkbox>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== KHỐI 2: GIÁ & TỒN KHO ===== -->
            <div class="form-section">
                <!-- Giá nhập, Đơn vị -->
                <div class="form-row two-columns">
                    <div class="form-field">
                        <label class="field-label required">Giá nhập</label>
                        <mat-form-field appearance="outline" class="form-input">
                            <input matInput placeholder="0 VND" formControlName="importPrice">
                        </mat-form-field>
                    </div>
                    <div class="form-field">
                        <label class="field-label required">Đơn vị</label>
                        <div class="unit-input-group">
                            <mat-form-field appearance="outline" class="unit-input">
                                <input matInput placeholder="Nhập đơn vị" formControlName="unit">
                            </mat-form-field>
                            <button mat-stroked-button type="button" class="add-unit-btn">
                                <mat-icon>menu</mat-icon>
                                <span>Thêm đơn vị</span>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Giá bán buôn, Barcode -->
                <div class="form-row two-columns">
                    <div class="form-field">
                        <label class="field-label required">Giá bán buôn/bán sỉ</label>
                        <mat-form-field appearance="outline" class="form-input">
                            <input matInput placeholder="0 VND" formControlName="wholesalePrice">
                        </mat-form-field>
                    </div>
                    <div class="form-field">
                        <label class="field-label">Barcode</label>
                        <div class="barcode-input-group">
                            <mat-form-field appearance="outline" class="barcode-input">
                                <input matInput placeholder="Nhập barcode hoặc sử dụng máy scan"
                                    formControlName="barcode">
                            </mat-form-field>
                            <button mat-icon-button type="button" class="refresh-btn">
                                <mat-icon>refresh</mat-icon>
                            </button>
                        </div>
                    </div>
                </div>
                <!-- Giá bán lẻ, Cảnh báo tồn kho -->
                <div class="form-row two-columns">
                    <div class="form-field">
                        <label class="field-label required">Giá bán lẻ</label>
                        <mat-form-field appearance="outline" class="form-input">
                            <input matInput placeholder="0 VND" formControlName="retailPrice">
                        </mat-form-field>
                    </div>
                    <div class="form-field">
                        <label class="field-label required">Số lượng cảnh báo hết hàng</label>
                        <mat-form-field appearance="outline" class="form-input">
                            <input matInput placeholder="Nhập số lượng cảnh báo" formControlName="stockAlert">
                        </mat-form-field>
                    </div>
                </div>
            </div>

            <!-- ===== KHỐI 3: THIẾT LẬP BÁN HÀNG ===== -->
            <div class="form-section">
                <div class="form-footer">
                    <div class="checkbox-group">
                        <div class="checkbox-row">
                            <mat-checkbox formControlName="allowSelling" color="primary">
                                Cho phép bán
                            </mat-checkbox>
                            <mat-checkbox formControlName="fastSell" color="primary">
                                Bán nhanh
                            </mat-checkbox>
                        </div>
                        <div class="checkbox-row">
                            <mat-checkbox formControlName="lot" color="primary">
                                Lô, hạn sử dụng
                            </mat-checkbox>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>